<script type="text/javascript">
Ext.onReady(function(){
    var Menu = Ext.data.Record.create([
    {
        name: 'id',
        type: 'integer'
    },{
        name: 'codename',
        type: 'string'
    }
    ,{
        name: 'title',
        type: 'string'
    },
    {
        name: 'description',
        type: 'string'
    }]);
    
    var store = new Ext.data.GroupingStore({
        reader: new Ext.data.JsonReader({root: 'menus',fields: Menu}),
        proxy: new Ext.data.HttpProxy({url: '<iz:insert:url/><iz:insert:config path="root.response.json"/>menu/getMenu/',method:'GET'}),
        autoLoad: true,        
        sortInfo: {field: 'title', direction: 'ASC'}
    });

    var grid = new Ext.grid.GridPanel({ 
        
        id: 'grid-menu',
        store: store,
        layout: 'fit',
        margins: '0 5 5 5',
        autoExpandColumn: 'title',
        autoHeight: true,
        loadMask: true,
        view: new Ext.grid.GroupingView({
            markDirty: false
        }),
        tbar: [
            {
                text: 'Add New Menu'
                , iconCls: IconManager.getIcon('package_add')
                , handler: function()
                {
                    Ext.getBody().mask();
                    AlertBox.show('Redirecting', 'Please wait ...', 'smile');                    
                    window.location.href = '<iz:insert:uri/>menu/createMenu/';
                }
            }
            ,{
                ref: '../deleteBtn',
                iconCls: IconManager.getIcon('package_remove'),
                text: 'Delete Menu',
                disabled: true,
                handler: function(){
                    
                    var s = grid.getSelectionModel().getSelections();
                    /*
                    for(var i = 0, r; r = s[i]; i++){
                        store.remove(r);
                    }*/
                }
            }
        ],
        stripeRows:true,

        columns: [
            new Ext.grid.RowNumberer(),
            {
                id: 'id',
                header: 'ID',
                dataIndex: 'id',
                width: 100,
                sortable: true
            },
            {
                id: 'codename',
                header: 'Codename',
                dataIndex: 'codename',
                width: 100,
                sortable: true
            },{
                id: 'title',
                header: 'Title',
                dataIndex: 'title',
                minWidth: 200
            },{
                id: 'description',
                header: 'Description',
                dataIndex: 'description',
                width: 100
            }
        ],
        listeners: {
            rowdblclick: function(grid, index, event){
                Ext.getBody().mask();
                AlertBox.show('Redirecting', 'Please wait ...', 'smile');
                var r = grid.getStore().getAt(index);
                window.location.href = '<iz:insert:uri/>menu/listMenuItemForMenuId/' + r.data.id;                
            }
        }
    });

    var layout = new Ext.Panel({
        iconCls: IconManager.getIcon('brick'),
        title: 'Navigation Menus',
        layout: 'fit',
        items: [grid],
        renderTo: 'entity-menu',
        frame: true
    });

    grid.getSelectionModel().on('selectionchange', function(sm){
        grid.deleteBtn.setDisabled(sm.getCount() < 1);
    });
});
</script>


<div class="action-container">
    <div class="action-header">
    </div>
    <div class="entity-container" id="entity-menu">
        
    </div>
</div>