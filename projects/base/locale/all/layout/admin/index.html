<!DOCTYPE HTML>
<html lang="en">
<head>
	<script type="text/javascript">
		var djConfig = {
			baseScriptUri : "projects/base/local/all/jslibs/dojo",
			parseOnLoad : true
		};
	</script>
	<iz:layout:pos position="meta" />
	<iz:layout:head />
	<script type="text/javascript">
		dojo.require("dijit.MenuBar");
		dojo.require("dijit.PopupMenuBarItem");
		dojo.require("dijit.Menu");
		dojo.require("dijit.MenuItem");
		dojo.require("dijit.PopupMenuItem");
		dojo.require("dijit.layout.SplitContainer");
		dojo.require("dijit.layout.LayoutContainer");
		dojo.require("dijit.layout.AccordionContainer");
		dojo.require("dojox.layout.ContentPane");
		dojo.require("dijit.Toolbar");
		dojo.require("dojo.parser");  // scan page for widgets and instantiate them
		dojo.require("dijit.layout.TabContainer");
	</script>
	<iz:layout:css path="~bootstrap.min" />
	<iz:layout:css path="~style" />
	<script type="text/javascript">
	
	var maxAjaxCalls = 5;
	var currentAjaxCalls = new Array();

	function Post(path, request, callbackFunction) {
	    //increment current ajax calls.
	    currentAjaxCalls[currentAjaxCalls.length] = path;
	    //make sure hasn't gone over max ajax calls.
	    var numAjaxCall = NumAjaxCalls(path);
	    if (numAjaxCall <= maxAjaxCalls) {
	        if (numAjaxCall > 1) {
	            console.debug("Invoking " + path + " ajax call for try #" + numAjaxCall);
	        }
	        dojo.xhrPost({
	            url: '<iz:insert:url/>' + path,
	            handleAs: 'json',
	            timeout: 60000,
	            content: request,
	            contentType: "application/x-www-form-urlencoded",
	            load: function(result) { PostSuccess(result, path, callbackFunction); },
	            error: function(error, args) { AjaxError(error, args, path, request, callbackFunction); }
	        });
	    }
	    else {
	        console.debug("Tried to make " + path + " ajax call " + maxAjaxCalls + " times but failed!");
	    }
	}

	function NumAjaxCalls(path) {
	    var numAjaxCalls = 0;
	    for (var k = 0; k < currentAjaxCalls.length; k++) {
	        if (currentAjaxCalls[k] == path) {
	            numAjaxCalls++;
	        }
	    }
	    return numAjaxCalls;
	}

	function PostSuccess(result, path, callbackFunction) {
	    //remove path from array.
	    for (var k = 0; k < currentAjaxCalls.length; k++) {
	        if (currentAjaxCalls[k] == path) {
	            currentAjaxCalls.splice(k, 1);
	            k--;
	        }
	    }
	    //invoke callback function.
	    callbackFunction(result);
	}

	function AjaxError(error, args, path, request, callbackFunction) {
	    //show error message.
	    console.debug("ajax error: " + error.message + " " + error.responseText);
	    //console.debug(error);
	    //try ajax call again in 1 second.
	    //window.setTimeout(function() { Post(path, request, callbackFunction); }, 1000);
	}

	</script>
</head>
<body class="claro">
	<div class="topbar" data-scrollspy="scrollspy">
		<div class="topbar-inner">
			<div class="container">
				<a class="brand">Oxygen CMS</a>
			</div>
		</div>
	</div>
    <div id="wrapper" class="container">
		<div id="banner"></div>
		<div id="navigation"></div>
		<div id="main">
			
			<iz:layout:pos position="main" />			
		</div>
		<div id="footer"></div>		
	</div>
	<iz:layout:foot />
</body>
</html>