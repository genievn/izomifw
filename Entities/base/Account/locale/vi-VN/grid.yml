attributes:
    type: "ExtGridPanel"
    title: Danh mục tài khoản người dùng
    pageSize: 20
    cm: "[{header: 'Username', dataIndex: 'username'},{header: 'Email', dataIndex: 'email'}]"
    lm: "Loading ... Please wait!"
    tbar:
        create:
            text: Thêm mới
            iconCls: IconManager.getIcon('add')
            handler: |
                function()
                {
                    var jsloader = new Ext.ux.JSLoader({
                        url: '<iz:insert:url/><iz:insert:config path="root.response.plain"/>form/create/Entities.Base.Account/',
                        closable: 1,
                        waitMsg: 'Đang tải dữ liệu ...',
                        onLoad:function(comp, options){}
                    });
                }
        delete:
            text: Xóa
            iconCls: IconManager.getIcon('delete')
            handler: |
                function()
                {
                    //console.log(this);
                    var grid = this.ownerCt.ownerCt;
                    Ext.MessageBox.confirm(
                        'Xác nhận',
                        'Bạn có chắc chắn không?',
                        function(btn, text) {
                            
                            if (btn=='yes') {
                                AlertBox.show('Kết nối hệ thống', 'Đang kết nối xử lý dữ liệu', 'loading', {timeout: 3});   
                                var recordSelModel = grid.getSelectionModel();
                                var recordCount = recordSelModel.getCount();
                                var recordArray = new Array();
                                
                                if (recordCount > 0) {
                                    var records = recordSelModel.getSelections();
                                    for (var i=0;i<recordCount;i++) {
                                        recordArray[i] = records[i].get('id');
                                    }
                                }
                                
                                
                                Ext.Ajax.request({
                                    url: '<iz:insert:url/><iz:insert:config path="root.response.json"/>form/delete/Entities.Base.Account/',
                                    method: 'POST',
                                    params: {
                                        ids: Ext.encode(recordArray)
                                    },
                                    success: function(){
                                        //AlertBox.show('Thành công', 'Tài khoản bạn chọn đã được xóa', 'success', {timeout: 6});                                        
                                        grid.store.reload();
                                    },
                                    scope: this
                                });
                            }
                        }
                    );
                }
    plugins:
        filters: "{type: 'string',  dataIndex: 'username'}"
        rowcontext:
            edit:
                text: 'Sửa thông tin tài khoản'
                icon: '/extra/shared/icons/bullet_edit.png'
                getDisabled: |
                    function(grid, ri, e, rec){
                        return false;
                    }
                beforeAdd: |
                    function(grid, ri, e, rec){
                        return true;
                    }
                handler: |
                    function(item,event,record,grid,ri)
                    {
                        var jsloader = new Ext.ux.JSLoader({
                            url: '<iz:insert:url/><iz:insert:config path="root.response.plain"/>form/edit/Entities.Base.Account/' + record.data.id + '/',
                            params:{lang: IZOMI.lang, id: record.data.id},
                            closable: 1,
                            waitMsg: 'Đang tải dữ liệu ...',
                            onLoad:function(comp, options){}
                        });
                    }
            assign_role:
                text: 'Gán vai trò người dùng'
                icon: '/extra/shared/icons/bullet_edit.png'
                getDisabled: |
                    function(grid, ri, e, rec){
                        return false;
                    }
                beforeAdd: |
                    function(grid, ri, e, rec){
                        return true;
                    }
                handler: |
                    function(item,event,record,grid,ri)
                    {
                        var jsloader = new Ext.ux.JSLoader({
                            url: '<iz:insert:url/><iz:insert:config path="root.response.plain"/>role/assign/' + record.data.id + '/',
                            params:{lang: IZOMI.lang, id: record.data.id},
                            closable: 1,
                            waitMsg: 'Đang tải dữ liệu ...',
                            onLoad:function(comp, options){}
                        });
                    }
    ds:
        type: "ExtGroupingStore"
        autoLoad: "{params:{start:0, limit:20}}"
        url: "/<iz:insert:config path=\"root.response.json\"/>form/retrieve/Entities.Base.Account/"
        reader:
            type: "ExtJsonReader"
            idProperty: "id"
            totalProperty: "meta.total"
            root: "data"
            record: "[{name: 'id'},{name: 'username'},{name: 'email'}]"
        sortInfo: "{field: 'username', direction: 'ASC'}"
        remoteSort: 
